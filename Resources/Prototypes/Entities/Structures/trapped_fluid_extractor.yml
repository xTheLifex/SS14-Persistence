- type: entity
  id: GasUnaryBaseNoItem
  parent: BaseMachine
  abstract: true
  placement:
    mode: SnapgridCenter
  components:
    # All this to remove a single component..
    # GasPipeSansLayers
    - type: Visibility
      layer: 1
    # - type: CollideOnAnchor
    - type: Anchorable
    - type: Rotatable
    - type: Destructible
      thresholds:
      - trigger: # for nukes
          !type:DamageTrigger
          damage: 200
        behaviors:
        - !type:DoActsBehavior
          acts: ["Destruction"]
      - trigger: # regular damage trigger (replace with broken pipe)
          !type:DamageTrigger
          damage: 100
        behaviors:
        - !type:PlaySoundBehavior
          sound:
            collection: MetalBreak
            params:
              volume: -8
        - !type:SpawnEntitiesBehavior
          spawn:
            GasPipeBroken:
              min: 1
              max: 1
          offset: 0
        - !type:DoActsBehavior
          acts: ["Breakage"]
    - type: Sprite
      sprite: Structures/Piping/Atmospherics/pipe.rsi
      drawdepth: ThinPipe
      visible: false
    - type: Appearance
    - type: PipeAppearance
    - type: PipeColorVisuals
    - type: PipeRestrictOverlap
    - type: AtmosUnsafeUnanchor
    - type: AtmosPipeColor
    - type: AtmosMonitoringConsoleDevice

    # GasPipeBase
    - type: AtmosPipeLayers
      spriteLayersRsiPaths:
        enum.PipeVisualLayers.Pipe:
          Primary: Structures/Piping/Atmospherics/pipe.rsi
          Secondary: Structures/Piping/Atmospherics/pipe_alt1.rsi
          Tertiary: Structures/Piping/Atmospherics/pipe_alt2.rsi

    # Unary
    - type: AtmosDevice
    - type: Tag
      tags:
        - Unstackable
    - type: SubFloorHide
      blockInteractions: false
      blockAmbience: false
    - type: NodeContainer
      nodes:
        pipe:
          !type:PipeNode
          nodeGroupID: Pipe
          pipeDirection: south-facing

    # Extra
    - type: Clickable
    - type: InteractionOutline
    - type: LightningTarget
      priority: 1
    - type: Damageable
      damageContainer: StructuralInorganic
      damageModifierSet: StructuralMetallic

    - type: Transform
      noRot: false
      anchored: true

- type: entity
  parent: GasUnaryBaseNoItem
  id: TrappedFluidExtractor
  name: gas miner
  description: Has a valve and pump attached to it.
  placement:
    mode: SnapgridCenter
  components:
    - type: Tag
      tags:
        - Unstackable
        - Structure

    - type: SubFloorHide
      visibleLayers:
      - enum.SubfloorLayers.FirstLayer
    - type: Sprite
      drawdepth: FloorObjects
      sprite: _NF/Objects/Specific/Atmospherics/extractor.rsi
      layers:
        - sprite: Structures/Piping/Atmospherics/pipe.rsi
          state: pipeUnaryConnectors
          map: [ "enum.PipeVisualLayers.Pipe" ]
        - state: 'base'
          map: [ "enum.GasVolumePumpVisualLayers.Base" ]

        - state: 'drill-off'
          map: [ "enum.GasVolumePumpVisualLayers.Drill" ]

        - map: [ "enum.GasVolumePumpVisualLayers.PowerIndicator" ]
        - map: [ "enum.GasVolumePumpVisualLayers.PowerIndicator", "active" ]
    - type: Appearance
    - type: GenericVisualizer
      visuals:
        enum.TrappedFluidExtractorVisuals.State:
          enum.GasVolumePumpVisualLayers.Drill:
            Off: { state: 'drill-off' }
            On: { state: drill }
          enum.GasVolumePumpVisualLayers.PowerIndicator:
            Off: { state: 'base' }
            On: { state: 'base-powered' }
          active:
            Off: { state: 'base', visible: False }
            On: { state: 'drill-on-unlit' }

    # - type: GenericVisualizer
    #   visuals:
    #     enum.GasVolumePumpVisuals.State:
    #       enabled:
    #         On: { state: pumpVolumeOn }
    #         Off: { state: pumpVolume }
    #         Blocked: { state: pumpVolumeBlocked }

    - type: AtmosDevice
    - type: TrappedFluidExtractor

    - type: AmbientSound
      enabled: true
      volume: -12
      range: 5
      sound:
        path: /Audio/Ambience/Objects/gas_pump.ogg

    # - type: ApcPowerReceiver
    #   powerDisabled: True
    - type: PowerSwitch
    - type: PowerConsumer
      voltage: Medium
      drawRate: 500

    - type: NodeContainer
      examinable: true
      nodes:
        input:
          !type:CableDeviceNode
          nodeGroupID: MVPower
        pipe:
          !type:PipeNode
          nodeGroupID: Pipe
          pipeDirection: South
