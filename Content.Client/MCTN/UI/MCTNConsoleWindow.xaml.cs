using Content.Client.Computer;
using Content.Client.MCTN.BUI;
using Content.Client.UserInterface.Controls;
using Content.Shared.MCTN.BUIStates;
using Robust.Client.AutoGenerated;
using Robust.Client.Graphics;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.MCTN.UI;

[GenerateTypedNameReferences]
public sealed partial class MCTNConsoleWindow : FancyWindow,
    IComputerWindow<MCTNBoundUserInterfaceState>
{
    public MCTNBoundUserInterface BUI = default!;

    public MCTNConsoleWindow()
    {
        RobustXamlLoader.Load(this);
    }

    public void UpdateState(MCTNBoundUserInterfaceState scc)
    {
        // RadarScreen.UpdateState(scc);
        AvailableConnectionsScroll.RemoveAllChildren();
        AvailablePortsScroll.RemoveAllChildren();

        AvailableConnectionsControl.Visible = scc.CurrentConnection == null;
        CurrentConnectionControl.Visible = scc.CurrentConnection != null;

        if (scc.CurrentConnection == null)
        {
            var i = 0;
            foreach (var conn in scc.AvailableConnections)
            {
                var child = new MCTNAvailableConnectionRow(BUI, conn)
                {
                    PanelOverride = new StyleBoxFlat(i % 2 == 0 ? Color.FromHex("#222222") : Color.FromHex("#292929ff"))
                };
                AvailableConnectionsScroll.AddChild(child);
                i++;
            }
        }
        else
        {
            var i = 0;
            foreach (var port in scc.PlugStates)
            {
                var child = new MCTNPlugCard(BUI, port.Value)
                {
                    PanelOverride = new StyleBoxFlat(i % 2 == 0 ? Color.FromHex("#222222") : Color.FromHex("#292929ff"))
                };
                AvailablePortsScroll.AddChild(child);
                i++;
            }

            // Disconnect logic
            DisconnectBtn.OnPressed += (args) =>
            {
                if (BUI == null) return;
                BUI.SendMessage(new MCTNDisconnectMessage());
            };
        }
    }
}
